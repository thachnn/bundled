--- a/node_modules/ansi-styles/index.js
+++ b/node_modules/ansi-styles/index.js
@@ -162,4 +162 @@ function assembleStyles() {
-Object.defineProperty(module, 'exports', {
-	enumerable: true,
-	get: assembleStyles
-});
+module.exports = assembleStyles();
--- a/node_modules/chardet/index.js
+++ b/node_modules/chardet/index.js
@@ -10 +10 @@ var utf8  = require('./encoding/utf8'),
-var self = this;
+var self = module.exports;
--- a/node_modules/form-data/lib/form_data.js
+++ b/node_modules/form-data/lib/form_data.js
@@ -9 +9 @@ var mime = require('mime-types');
-var asynckit = require('asynckit');
+var asynckit = {parallel: require('asynckit/parallel')};
--- a/node_modules/is-windows/index.js
+++ b/node_modules/is-windows/index.js
@@ -8 +8 @@
-(function(factory) {
+/*(function(factory) {
@@ -23,2 +23,2 @@
-  'use strict';
-  return function isWindows() {
+*/'use strict';
+  module.exports = function isWindows() {
@@ -27 +27,0 @@
-});
--- a/node_modules/js-yaml/lib/js-yaml/loader.js
+++ b/node_modules/js-yaml/lib/js-yaml/loader.js
@@ -126 +126 @@ var simpleEscapeMap = new Array(256);
-for (var i = 0; i < 256; i++) {
+for (let i = 0; i < 256; i++) {
--- a/node_modules/js-yaml/lib/js-yaml/schema/failsafe.js
+++ b/node_modules/js-yaml/lib/js-yaml/schema/failsafe.js
@@ -11,5 +11,6 @@ var Schema = require('../schema');
+var _str = require('../type/str');
+var _seq = require('../type/seq');
+var _map = require('../type/map');
 module.exports = new Schema({
   explicit: [
-    require('../type/str'),
-    require('../type/seq'),
-    require('../type/map')
+    _str, _seq, _map
--- a/node_modules/jsbn/index.js
+++ b/node_modules/jsbn/index.js
@@ -1 +1,0 @@
-(function(){
@@ -1350 +1349 @@
-  if (typeof exports !== 'undefined') {
+  if (true) {
@@ -1357 +1356,0 @@
-}).call(this);
--- a/node_modules/lodash/_cloneBuffer.js
+++ b/node_modules/lodash/_cloneBuffer.js
@@ -3 +3 @@ import root from './_root.js';
-/** Detect free variable `exports`. */
+/** Detect free variable `exports`.
@@ -6 +6,0 @@ var freeExports = typeof exports == 'object' && exports && !exports.nodeType &&
-/** Detect free variable `module`. */
@@ -9 +8,0 @@ var freeModule = freeExports && typeof module == 'object' && module && !module.n
-/** Detect the popular CommonJS extension `module.exports`. */
@@ -13 +11 @@ var moduleExports = freeModule && freeModule.exports === freeExports;
-var Buffer = moduleExports ? root.Buffer : undefined,
+var Buffer = true ? root.Buffer : undefined,
--- a/node_modules/lodash/_nodeUtil.js
+++ b/node_modules/lodash/_nodeUtil.js
@@ -3 +3 @@ import freeGlobal from './_freeGlobal.js';
-/** Detect free variable `exports`. */
+/** Detect free variable `exports`.
@@ -6 +6,0 @@ var freeExports = typeof exports == 'object' && exports && !exports.nodeType &&
-/** Detect free variable `module`. */
@@ -9 +8,0 @@ var freeModule = freeExports && typeof module == 'object' && module && !module.n
-/** Detect the popular CommonJS extension `module.exports`. */
@@ -13 +11 @@ var moduleExports = freeModule && freeModule.exports === freeExports;
-var freeProcess = moduleExports && freeGlobal.process;
+var freeProcess = true && freeGlobal.process;
@@ -19 +17 @@ var nodeUtil = (function() {
-    var types = freeModule && freeModule.require && freeModule.require('util').types;
+    var types = /*freeModule && freeModule.require &&*/ module.require('util').types;
--- a/node_modules/lodash/isBuffer.js
+++ b/node_modules/lodash/isBuffer.js
@@ -4 +4 @@ import stubFalse from './stubFalse.js';
-/** Detect free variable `exports`. */
+/** Detect free variable `exports`.
@@ -7 +7,0 @@ var freeExports = typeof exports == 'object' && exports && !exports.nodeType &&
-/** Detect free variable `module`. */
@@ -10 +9,0 @@ var freeModule = freeExports && typeof module == 'object' && module && !module.n
-/** Detect the popular CommonJS extension `module.exports`. */
@@ -14 +12 @@ var moduleExports = freeModule && freeModule.exports === freeExports;
-var Buffer = moduleExports ? root.Buffer : undefined;
+var Buffer = true ? root.Buffer : undefined;
--- a/node_modules/object-path/index.js
+++ b/node_modules/object-path/index.js
@@ -1 +1 @@
-(function (root, factory){
+/*(function (root, factory){
@@ -4 +4,0 @@
-  /*istanbul ignore next:cant test*/
@@ -14 +13 @@
-})(this, function(){
+})(this, function(){*/
@@ -291,2 +290 @@
-  return mod;
-});
+  module.exports = mod;
--- a/node_modules/puka/index.js
+++ b/node_modules/puka/index.js
@@ -600,3 +600 @@ class ShellString {
-    for (var _len = arguments.length, values = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
-      values[_key - 1] = arguments[_key];
-    }
+    var values = Array.prototype.slice.call(arguments, 1);
--- a/node_modules/resolve/lib/sync.js
+++ b/node_modules/resolve/lib/sync.js
@@ -133,0 +133,2 @@ module.exports = function (x, options) {
+module.exports.core = core;
+module.exports.sync = module.exports;
\ No newline at end of file
--- a/node_modules/sshpk/lib/private-key.js
+++ b/node_modules/sshpk/lib/private-key.js
@@ -254,0 +254,2 @@ PrivateKey._oldVersionDetect = function (obj) {
+PrivateKey.PrivateKey = PrivateKey;
+PrivateKey.parsePrivateKey = PrivateKey.parse;
\ No newline at end of file
--- a/node_modules/ssri/index.js
+++ b/node_modules/ssri/index.js
@@ -3 +3 @@
-const Buffer = require('safe-buffer').Buffer
+const Buffer = require('buffer').Buffer
@@ -36 +36 @@ class Hash {
-    return this.digest && Buffer.from(this.digest, 'base64').toString('hex')
+    return this.digest && (Buffer.from || Buffer)(this.digest, 'base64').toString('hex')
@@ -172 +172 @@ function fromHex (hexDigest, algorithm, opts) {
-      Buffer.from(hexDigest, 'hex').toString('base64')
+      (Buffer.from || Buffer)(hexDigest, 'hex').toString('base64')
--- a/node_modules/tweetnacl/nacl-fast.js
+++ b/node_modules/tweetnacl/nacl-fast.js
@@ -1 +1 @@
-(function(nacl) {
+/*(function(nacl) {*/ var nacl = module.exports;
@@ -2388 +2388,0 @@ nacl.setPRNG = function(fn) {
-})(typeof module !== 'undefined' && module.exports ? module.exports : (self.nacl = self.nacl || {}));
--- a/node_modules/uuid/v4.js
+++ b/node_modules/uuid/v4.js
@@ -29 +29 @@ function v4(options, buf, offset) {
-module.exports = v4;
+module.exports = v4.v4 = v4;
--- a/node_modules/yarn/src/cli/commands/config.js
+++ b/node_modules/yarn/src/cli/commands/config.js
@@ -41 +41,3 @@ const CONFIG_KEYS = [
+  'packageDateLimit',
+  'disableWrappersFolder',
 ];
--- a/node_modules/yarn/src/cli/commands/policies.js
+++ b/node_modules/yarn/src/cli/commands/policies.js
@@ -159 +159 @@ const {run, setFlags, examples} = buildSubCommands('policies', {
-    } else if (V2_NAMES.includes(range) || isLocalFile(range) || isV2Version(range)) {
+    } else if (V2_NAMES.indexOf(range) >= 0 || isLocalFile(range) || isV2Version(range)) {
--- a/node_modules/yarn/src/cli/index.js
+++ b/node_modules/yarn/src/cli/index.js
@@ -29 +29 @@ import {ProcessTermError} from '../errors';
-process.stdout.prependListener('error', err => {
+process.stdout[typeof process.stdout.prependListener == 'function' ? 'prependListener' : 'on']('error', err => {
@@ -137 +137,2 @@ export async function main({
   commander.option('--otp <otpcode>', 'one-time password for two factor authentication');
+  commander.option('--package-date-limit <time>', 'only install package version that have release date before this');
@@ -560 +561,2 @@ export async function main({
       otp: commander.otp,
+      packageDateLimit: commander.packageDateLimit,
@@ -671,3 +673,3 @@ async function start(): Promise<void> {
-export const autoRun = module.children.length === 0;
+export const autoRun = require.main === module;
 
-if (require.main === module) {
+if (autoRun) {
--- a/node_modules/yarn/src/config.js
+++ b/node_modules/yarn/src/config.js
@@ -72 +72,3 @@ export type ConfigOptions = {
   otp?: string,
+  packageDateLimit?: ?string,
+  disableWrappersFolder?: boolean,
@@ -207 +209,3 @@ export default class Config {
   otp: ?string;
+  packageDateLimit: ?string;
+  disableWrappersFolder: boolean;
@@ -347 +351,4 @@ export default class Config {
+    this.packageDateLimit = opts.packageDateLimit || String(this.getOption('package-date-limit') || '') || null;
+    this.disableWrappersFolder = Boolean(this.getOption('disable-wrappers-folder'));
+
     this.globalFolder = opts.globalFolder || String(this.getOption('global-folder', true));
@@ -828 +835 @@ export default class Config {
-    for (const file of new Set([].concat(...files))) {
+    for (const file of new Set(Array.prototype.concat.apply([], files))) {
--- a/node_modules/yarn/src/errors.js
+++ b/node_modules/yarn/src/errors.js
@@ -24,2 +24,6 @@ export class ProcessTermError extends MessageError {
-  EXIT_CODE: ?number;
-  EXIT_SIGNAL: ?string;
+  constructor(msg: string, code?: string) {
+    super(msg, code);
+  }
+
+  EXIT_CODE: ?number = undefined;
+  EXIT_SIGNAL: ?string = undefined;
--- a/node_modules/yarn/src/fetchers/tarball-fetcher.js
+++ b/node_modules/yarn/src/fetchers/tarball-fetcher.js
@@ -44 +44,5 @@ export default class TarballFetcher extends BaseFetcher {
+  constructor(dest: string, remote: PackageRemote, config: Config) {
+    super(dest, remote, config);
+  }
+
   validateError: ?Object = null;
@@ -100 +104,0 @@ export default class TarballFetcher extends BaseFetcher {
-    const fs = require('fs');
--- a/node_modules/yarn/src/lockfile/parse.js
+++ b/node_modules/yarn/src/lockfile/parse.js
@@ -75 +75 @@ function* tokenise(input: string): Iterator<Token> {
-      if (nextNewline === -1) {
+      if (nextNewline < 0) {
@@ -388 +388,2 @@ function parse(str: string, fileLoc: string): Object {
+  let error: any;
   if (!fileLoc.endsWith(`.yml`)) {
@@ -391,10 +392,4 @@ function parse(str: string, fileLoc: string): Object {
     } catch (error1) {
+      error = error1;
+  } }
       try {
-        return safeLoad(str, {
-          schema: FAILSAFE_SCHEMA,
-        });
-      } catch (error2) {
-        throw error1;
-      }
-    }
-  } else {
@@ -409 +404,3 @@ function parse(str: string, fileLoc: string): Object {
+  } catch (error2) {
+    throw error || error2;
   }
--- a/node_modules/yarn/src/package-hoister.js
+++ b/node_modules/yarn/src/package-hoister.js
@@ -938 +938 @@ export class NohoistResolver {
-  initNohoist = (info: HoistManifest, parent: ?HoistManifest) => {
+  initNohoist(info: HoistManifest, parent: ?HoistManifest) {
@@ -959,2 +959,2 @@ export class NohoistResolver {
     info.isNohoist = this._isNohoist(info);
-  };
+  }
@@ -970 +970 @@ export class NohoistResolver {
-  highestHoistingPoint = (info: HoistManifest): ?number => {
+  highestHoistingPoint(info: HoistManifest): ?number {
@@ -972,4 +972,4 @@ export class NohoistResolver {
-  };
+  }
 
   // private functions
-  _isNohoist = (info: HoistManifest): boolean => {
+  _isNohoist(info: HoistManifest): boolean {
@@ -986,2 +986,2 @@ export class NohoistResolver {
-  };
-  _isRootPackage = (pkg: Manifest): boolean => {
+  }
+  _isRootPackage(pkg: Manifest): boolean {
@@ -989,2 +989,2 @@ export class NohoistResolver {
-  };
-  _originalPath = (info: HoistManifest): string => {
+  }
+  _originalPath(info: HoistManifest): string {
@@ -998 +998 @@ export class NohoistResolver {
-  _isTopPackage = (info: HoistManifest): boolean => {
+  _isTopPackage(info: HoistManifest): boolean {
@@ -1005,2 +1005,2 @@ export class NohoistResolver {
-  };
-  _isLink = (info: HoistManifest): boolean => {
+  }
+  _isLink(info: HoistManifest): boolean {
@@ -1012 +1012 @@ export class NohoistResolver {
-  _extractNohoistList = (pkg: Manifest, pathPrefix: string): ?Array<string> => {
+  _extractNohoistList(pkg: Manifest, pathPrefix: string): ?Array<string> {
@@ -1019,2 +1019,2 @@ export class NohoistResolver {
     return nohoistList;
-  };
+  }
--- a/node_modules/yarn/src/registries/yarn-registry.js
+++ b/node_modules/yarn/src/registries/yarn-registry.js
@@ -101 +101 @@ export default class YarnRegistry extends NpmRegistry {
-          if (FOLDER_KEY.includes(key)) {
+          if (FOLDER_KEY.indexOf(key) >= 0) {
--- a/node_modules/yarn/src/resolvers/registries/npm-resolver.js
+++ b/node_modules/yarn/src/resolvers/registries/npm-resolver.js
@@ -27 +27,2 @@ type RegistryResponse = {
+  time?: {[key: string]: ?string},
 };
@@ -51 +52,16 @@ export default class NpmResolver extends RegistryResolver {
+    // Only install package version that have release date before a specified one.
+    // That date string must match JSON format, e.g. 2020-08-14T04:47:38.210Z
+    if (config.packageDateLimit && body.time) {
+      const releaseDates = body.time;
+      let closestVersion = null;
+      (semver: Object).rsort(Object.keys(body.versions)).some(v => {
+        if (releaseDates[v] && semver.satisfies(v, range)) {
+          closestVersion = v;
+          if (releaseDates[v] < config.packageDateLimit) return true;
+        }
+        return false;
+      });
+      if (closestVersion) return body.versions[closestVersion];
+    }
+
     // If the latest tag in the registry satisfies the requested range, then use that.
@@ -97 +113 @@ export default class NpmResolver extends RegistryResolver {
-    const body = await this.config.registries.npm.request(escapedName);
+    const body = await this.config.registries.npm.request(escapedName, {unfiltered: !!this.config.packageDateLimit});
--- a/node_modules/yarn/src/util/execute-lifecycle-script.js
+++ b/node_modules/yarn/src/util/execute-lifecycle-script.js
@@ -237 +237,2 @@ export async function makeEnv(
+  if (!config.disableWrappersFolder)
   pathParts.unshift(await getWrappersFolder(config));
--- a/node_modules/yarn/src/util/promise.js
+++ b/node_modules/yarn/src/util/promise.js
@@ -12,6 +12,3 @@ export function promisify(fn: Function, firstData?: boolean): (...args: Array<an
-      args.push(function(err, ...result) {
-        let res = result;
+      args.push(function(err) {
+        let res: any;
 
-        if (result.length <= 1) {
-          res = result[0];
-        }
@@ -21 +18,3 @@ export function promisify(fn: Function, firstData?: boolean): (...args: Array<an
           err = null;
+        } else {
+          res = arguments.length <= 2 ? arguments[1] : Array.prototype.slice.call(arguments, 1);
--- a/node_modules/micromatch/index.js
+++ b/node_modules/micromatch/index.js
@@ -63 +63 @@ function match(files, pattern, opts) {
-  if (utils.typeOf(files) !== 'string' && !Array.isArray(files)) {
+  if (typeof files != 'string' && !Array.isArray(files)) {
@@ -191 +191 @@ function isMatch(fp, pattern, opts) {
-  if (utils.typeOf(pattern) === 'object') {
+  if (typeof pattern == 'object' && utils.toStr(pattern) === '[object Object]') {
@@ -255 +255 @@ function matchKeys(obj, glob, options) {
-  if (utils.typeOf(obj) !== 'object') {
+  if (obj == null || typeof obj != 'object') {
@@ -386 +386 @@ function makeRe(glob, opts) {
-  if (utils.typeOf(glob) !== 'string') {
+  if (typeof glob != 'string') {
--- a/node_modules/micromatch/lib/utils.js
+++ b/node_modules/micromatch/lib/utils.js
@@ -19 +19 @@ utils.isGlob = require('is-glob');
-utils.typeOf = require('kind-of');
+utils.toStr = Function.call.bind(Object.prototype.toString);
--- a/node_modules/performance-now/lib/performance-now.js
+++ b/node_modules/performance-now/lib/performance-now.js
@@ -2 +2,0 @@
-(function() {
@@ -34 +33,0 @@
-}).call(this);
--- a/node_modules/randomatic/index.js
+++ b/node_modules/randomatic/index.js
@@ -11 +11,0 @@ var isNumber = require('is-number');
-var typeOf = require('kind-of');
@@ -62 +61 @@ function randomatic(pattern, length, options) {
-  if (typeOf(length) === 'object' && length.hasOwnProperty('chars')) {
+  if (length != null && typeof length == 'object' && length.hasOwnProperty('chars')) {
--- a/node_modules/readable-stream/lib/_stream_readable.js
+++ b/node_modules/readable-stream/lib/_stream_readable.js
@@ -626,2 +626,2 @@ Readable.prototype.pipe = function (dest, pipeOpts) {
-        debug('false write response, pause', src._readableState.awaitDrain);
-        src._readableState.awaitDrain++;
+        debug('false write response, pause', state.awaitDrain);
+        state.awaitDrain++;
@@ -721 +721 @@ Readable.prototype.unpipe = function (dest) {
-      dests[i].emit('unpipe', this, unpipeInfo);
+      dests[i].emit('unpipe', this, { hasUnpiped: false });
--- a/node_modules/readable-stream/lib/_stream_writable.js
+++ b/node_modules/readable-stream/lib/_stream_writable.js
@@ -352 +352 @@ Writable.prototype.uncork = function () {
-    if (!state.writing && !state.corked && !state.finished && !state.bufferProcessing && state.bufferedRequest) clearBuffer(this, state);
+    if (!state.writing && !state.corked && !state.bufferProcessing && state.bufferedRequest) clearBuffer(this, state);
@@ -594 +594 @@ Writable.prototype.end = function (chunk, encoding, cb) {
-  if (!state.ending && !state.finished) endWritable(this, state, cb);
+  if (!state.ending) endWritable(this, state, cb);
@@ -655,5 +655,2 @@ function onCorkedFinish(corkReq, state, err) {
-  if (state.corkedRequestsFree) {
+  // reuse the free corkReq.
     state.corkedRequestsFree.next = corkReq;
-  } else {
-    state.corkedRequestsFree = corkReq;
-  }
--- a/node_modules/readable-stream/lib/internal/streams/BufferList.js
+++ b/node_modules/readable-stream/lib/internal/streams/BufferList.js
@@ -59 +59,0 @@ module.exports = function () {
-    if (this.length === 1) return this.head.data;
--- a/node_modules/readable-stream/lib/internal/streams/destroy.js
+++ b/node_modules/readable-stream/lib/internal/streams/destroy.js
@@ -18,2 +18,3 @@ function destroy(err, cb) {
     } else if (err && (!this._writableState || !this._writableState.errorEmitted)) {
+      if (this._writableState) this._writableState.errorEmitted = true;
       pna.nextTick(emitErrorNT, this, err);
@@ -37,7 +38,7 @@ function destroy(err, cb) {
-    if (!cb && err) {
-      pna.nextTick(emitErrorNT, _this, err);
+    if (cb) {
+      cb(err);
+    } else if (err && (!_this._writableState || !_this._writableState.errorEmitted)) {
       if (_this._writableState) {
         _this._writableState.errorEmitted = true;
       }
-    } else if (cb) {
-      cb(err);
+      pna.nextTick(emitErrorNT, _this, err);
@@ -62 +63,3 @@ function undestroy() {
+    this._writableState.finalCalled = false;
+    this._writableState.prefinished = false;
     this._writableState.finished = false;
--- a/node_modules/resolve/lib/core.json
+++ b/node_modules/resolve/lib/core.json
@@ -18 +18,3 @@
-    "fs/promises": ">= 10 && < 10.1",
+    "_debug_agent": ">= 1 && < 8",
+    "diagnostics_channel": [">= 14.17 && < 15", ">= 15.1"],
+    "fs/promises": [">= 10 && < 10.1", ">= 14"],
@@ -32,3 +34,3 @@
-    "node-inspect/lib/_inspect": ">= 7.6.0",
-    "node-inspect/lib/internal/inspect_client": ">= 7.6.0",
-    "node-inspect/lib/internal/inspect_repl": ">= 7.6.0",
+    "node-inspect/lib/_inspect": ">= 7.6 && < 12",
+    "node-inspect/lib/internal/inspect_client": ">= 7.6 && < 12",
+    "node-inspect/lib/internal/inspect_repl": ">= 7.6 && < 12",
@@ -62,7 +64,8 @@
-    "v8/tools/arguments": ">= 10",
-    "v8/tools/codemap": [">= 4.4.0 && < 5", ">= 5.2.0"],
-    "v8/tools/consarray": [">= 4.4.0 && < 5", ">= 5.2.0"],
-    "v8/tools/csvparser": [">= 4.4.0 && < 5", ">= 5.2.0"],
-    "v8/tools/logreader": [">= 4.4.0 && < 5", ">= 5.2.0"],
-    "v8/tools/profile_view": [">= 4.4.0 && < 5", ">= 5.2.0"],
-    "v8/tools/splaytree": [">= 4.4.0 && < 5", ">= 5.2.0"],
+    "v8/tools/arguments": ">= 10 && < 12",
+    "v8/tools/codemap": [">= 4.4 && < 5", ">= 5.2 && < 12"],
+    "v8/tools/consarray": [">= 4.4 && < 5", ">= 5.2 && < 12"],
+    "v8/tools/csvparser": [">= 4.4 && < 5", ">= 5.2 && < 12"],
+    "v8/tools/logreader": [">= 4.4 && < 5", ">= 5.2 && < 12"],
+    "v8/tools/profile_view": [">= 4.4 && < 5", ">= 5.2 && < 12"],
+    "v8/tools/splaytree": [">= 4.4 && < 5", ">= 5.2 && < 12"],
+    "worker_threads": ">= 11.7",
